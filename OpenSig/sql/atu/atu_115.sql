# Atualizacoes da versao 1.1.5

# Atualiza o campo com_ecf_venda_produto_barra e no CAT52
ALTER TABLE `com_ecf_venda_produto` CHANGE COLUMN `com_ecf_venda_produto_codigo` `com_ecf_venda_produto_barra` VARCHAR(14) NULL DEFAULT NULL  ;
UPDATE `sis_exp_imp` SET `sis_exp_imp_modelo`='<beanio xmlns=\"http://www.beanio.org/2011/01\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.beanio.org/2011/01 http://www.beanio.org/2011/01/mapping.xsd\">\n\n	<stream name=\"cat52\" format=\"fixedlength\">\n		<record name=\"ecf\" minOccurs=\"1\" maxOccurs=\"1\" class=\"br.com.opensig.comercial.shared.modelo.ComEcf\">\n			<field name=\"tipo\" rid=\"true\" literal=\"E01\" length=\"3\" ignore=\"true\" />\n			<field name=\"comEcfSerie\" length=\"20\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfMfAdicional\" length=\"1\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfTipo\" length=\"7\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfMarca\" length=\"20\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfModelo\" length=\"20\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"f1\" length=\"24\" ignore=\"true\" />\n			<field name=\"comEcfCaixa\" length=\"3\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"f2\" length=\"68\" ignore=\"true\" />\n		</record>\n		<record name=\"z\" minOccurs=\"1\" maxOccurs=\"1\" class=\"br.com.opensig.comercial.shared.modelo.ComEcfZ\">\n			<field name=\"tipo\" rid=\"true\" literal=\"E12\" length=\"3\" ignore=\"true\" />\n			<field name=\"f1\" length=\"41\" ignore=\"true\" />\r\n			<field name=\"comEcfZUsuario\" length=\"2\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfZCrz\" length=\"6\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfZCooFin\" length=\"6\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfZCro\" length=\"6\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfZMovimento\" length=\"8\" type=\"date\" minOccurs=\"1\" maxOccurs=\"1\" format=\"yyyyMMdd\" />\n			<field name=\"comEcfZEmissao\" length=\"14\" type=\"datetime\" minOccurs=\"1\" maxOccurs=\"1\" format=\"yyyyMMddHHmmss\" />\n			<field name=\"comEcfZBruto\" length=\"14\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"issqn\" length=\"1\" minOccurs=\"1\" maxOccurs=\"1\" />\n		</record>\n		<record name=\"zt\" minOccurs=\"0\" maxOccurs=\"unbounded\" class=\"br.com.opensig.comercial.shared.modelo.ComEcfZTotais\">\n			<field name=\"tipo\" rid=\"true\" literal=\"E13\" length=\"3\" ignore=\"true\" />\n			<field name=\"f1\" length=\"49\" ignore=\"true\" />\n			<field name=\"comEcfZTotaisCodigo\" length=\"7\" minOccurs=\"1\" maxOccurs=\"1\" trim=\"true\" />\n			<field name=\"comEcfZTotaisValor\" length=\"13\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n		</record>\n		<record name=\"venda\" minOccurs=\"0\" maxOccurs=\"unbounded\" class=\"br.com.opensig.comercial.shared.modelo.ComEcfVenda\">\n			<field name=\"tipo\" rid=\"true\" literal=\"E14\" length=\"3\" ignore=\"true\" />\n			<field name=\"f1\" length=\"43\" ignore=\"true\" />\n			<field name=\"comEcfVendaCcf\" length=\"6\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfVendaCoo\" length=\"6\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfVendaData\" length=\"8\" type=\"date\" minOccurs=\"1\" maxOccurs=\"1\" format=\"yyyyMMdd\" />\n			<field name=\"comEcfVendaBruto\" length=\"14\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n                        <field name=\"comEcfVendaDesconto\" length=\"13\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"descIndicador\" length=\"1\" minOccurs=\"1\" maxOccurs=\"1\" trim=\"true\" />\n			<field name=\"comEcfVendaAcrescimo\" length=\"13\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"acresIndicador\" length=\"1\" minOccurs=\"1\" maxOccurs=\"1\" trim=\"true\" />\n			<field name=\"comEcfVendaLiquido\" length=\"14\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"cancelada\" length=\"1\"  minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"f2\" length=\"68\" ignore=\"true\" />\n		</record>\n		<record name=\"produto\" minOccurs=\"0\" maxOccurs=\"unbounded\" class=\"br.com.opensig.comercial.shared.modelo.ComEcfVendaProduto\">\n			<field name=\"tipo\" rid=\"true\" literal=\"E15\" length=\"3\" ignore=\"true\" />\n			<field name=\"f1\" length=\"43\" ignore=\"true\" />\n			<field name=\"comEcfVendaProdutoCoo\" length=\"6\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"f2\" length=\"6\" ignore=\"true\" />\n			<field name=\"comEcfVendaProdutoOrdem\" length=\"3\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfVendaProdutoBarra\" length=\"14\" minOccurs=\"1\" maxOccurs=\"1\" trim=\"true\" />\n			<field name=\"comEcfVendaProdutoDescricao\" length=\"100\" minOccurs=\"1\" maxOccurs=\"1\" trim=\"true\" />\n			<field name=\"comEcfVendaProdutoQuantidade\" length=\"7\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfVendaProdutoUnd\" length=\"3\" minOccurs=\"1\" maxOccurs=\"1\" trim=\"true\"/>\n			<field name=\"comEcfVendaProdutoBruto\" length=\"8\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfVendaProdutoDesconto\" length=\"8\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfVendaProdutoAcrescimo\" length=\"8\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"comEcfVendaProdutoTotal\" length=\"14\" type=\"double\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"f3\" length=\"7\" ignore=\"true\" />\n			<field name=\"cancelado\" length=\"1\" minOccurs=\"1\" maxOccurs=\"1\" />\n			<field name=\"f4\" length=\"36\" ignore=\"true\" />\n		</record>\r\n		<record name=\"documento\" minOccurs=\"0\" maxOccurs=\"unbounded\" class=\"br.com.opensig.comercial.shared.modelo.ComEcfDocumento\">\r\n			<field name=\"tipo\" rid=\"true\" literal=\"E16\" length=\"3\" ignore=\"true\" />\r\n			<field name=\"f1\" length=\"43\" ignore=\"true\" />\r\n			<field name=\"comEcfDocumentoCoo\" length=\"6\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\r\n			<field name=\"comEcfDocumentoGnf\" length=\"6\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\r\n			<field name=\"comEcfDocumentoGrg\" length=\"6\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\r\n			<field name=\"comEcfDocumentoCdc\" length=\"4\" type=\"int\" minOccurs=\"1\" maxOccurs=\"1\" />\r\n			<field name=\"comEcfDocumentoTipo\" length=\"2\" minOccurs=\"1\" maxOccurs=\"1\" />\r\n			<field name=\"comEcfDocumentoData\" length=\"14\" type=\"datetime\" minOccurs=\"1\" maxOccurs=\"1\" format=\"yyyyMMddHHmmss\" />\r\n		</record>\n	</stream>\n</beanio>' WHERE `sis_exp_imp_id`='4';

# Colocando 4 casas decimais na quantidade
ALTER TABLE `com_troca_produto` CHANGE COLUMN `com_troca_produto_quantidade` `com_troca_produto_quantidade` DECIMAL(10,4) NOT NULL  ;
ALTER TABLE `com_ecf_nota_produto` CHANGE COLUMN `com_ecf_nota_produto_quantidade` `com_ecf_nota_produto_quantidade` DECIMAL(10,4) NOT NULL  ;

# Colocando o campo de decreto para a natureza de operacao
ALTER TABLE `com_natureza` ADD COLUMN `com_natureza_decreto` VARCHAR(1000) NOT NULL  AFTER `com_natureza_cofins` ;

# Colocando o campo de barra nos produtos da compra
ALTER TABLE `com_compra_produto` ADD COLUMN `com_compra_produto_barra` VARCHAR(14) NULL  AFTER `prod_embalagem_id` ;

# Aumentando o campo de observacao da compra e venda para o limite de 4000, pois a nfe suporte 5000
ALTER TABLE `com_compra` CHANGE COLUMN `com_compra_observacao` `com_compra_observacao` VARCHAR(4000) NOT NULL  ;
ALTER TABLE `com_venda` CHANGE COLUMN `com_venda_observacao` `com_venda_observacao` VARCHAR(4000) NOT NULL  ;

# Acao que gera uma venda a partir de uma compra
INSERT INTO `sis_acao` (`sis_funcao_id`, `sis_acao_classe`, `sis_acao_ordem`, `sis_acao_subordem`, `sis_acao_ativo`, `sis_acao_visivel`) 
SELECT `sis_funcao_id`, 'br.com.opensig.comercial.client.controlador.comando.acao.ComandoGerarVenda', '16', '0', '1', '1' FROM `sis_funcao` 
WHERE `sis_funcao_classe` = 'br.com.opensig.comercial.client.controlador.comando.ComandoCompra';
